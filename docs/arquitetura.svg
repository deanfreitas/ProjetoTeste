<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="640" viewBox="0 0 1000 640" role="img" aria-labelledby="title desc">
  <title id="title">Desenho da Arquitetura - Sistema de Inventário Orientado a Eventos</title>
  <desc id="desc">Fluxo: POS e Admin produzem eventos para Kafka (vendas, ajustes_estoque). Serviço de Cadastro produz eventos de produtos e lojas. Inventário consome vendas/ajustes/produtos/lojas e atualiza o DB de Inventário. Pedidos e Análise consomem vendas. Serviço de Consulta lê o DB e é consultado pelo Frontend.</desc>
  <defs>
    <style>
      .box{fill:#fff;stroke:#1f2937;stroke-width:2;rx:8;ry:8}
      .topic{fill:#eef2ff;stroke:#4338ca}
      .broker{fill:#f0fdf4;stroke:#166534}
      .label{font-family:Arial, Helvetica, sans-serif;font-size:13px;fill:#111827}
      .small{font-size:12px;fill:#374151}
      .arrow{marker-end:url(#arrow)}
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L10,3 L0,6 Z" fill="#374151"/>
    </marker>
  </defs>

  <!-- Colunas -->
  <text x="90" y="30" class="small">Loja</text>
  <text x="260" y="30" class="small">Admin</text>
  <text x="430" y="30" class="small">Apache Kafka</text>
  <text x="720" y="30" class="small">Backend</text>
  <text x="900" y="30" class="small">Frontend</text>

  <!-- Loja / POS -->
  <rect x="30" y="60" width="160" height="70" class="box"/>
  <text x="40" y="90" class="label">Sistema da Loja</text>
  <text x="40" y="110" class="small">(Ponto de Venda)</text>

  <!-- Admin -->
  <rect x="210" y="60" width="160" height="70" class="box"/>
  <text x="220" y="92" class="label">Sistema de Administração</text>

  <!-- Serviço de Cadastro (novo) -->
  <rect x="210" y="150" width="160" height="90" class="box"/>
  <text x="220" y="175" class="label">Serviço de Cadastro</text>
  <text x="220" y="195" class="small">produz: produtos, lojas</text>

  <!-- Kafka / Broker -->
  <rect x="395" y="50" width="220" height="270" class="box broker"/>
  <text x="405" y="75" class="label">Broker: Apache Kafka</text>
  <rect x="415" y="100" width="180" height="50" class="box topic"/>
  <text x="425" y="130" class="label">tópico: vendas</text>
  <rect x="415" y="165" width="180" height="50" class="box topic"/>
  <text x="425" y="195" class="label">tópico: ajustes_estoque</text>
  <rect x="415" y="230" width="180" height="50" class="box topic"/>
  <text x="425" y="260" class="label">tópicos: produtos, lojas</text>

  <!-- Backend services -->
  <rect x="640" y="60" width="280" height="160" class="box"/>
  <text x="650" y="85" class="label">Serviço de Inventário</text>
  <text x="650" y="105" class="small">consome: vendas, ajustes_estoque</text>
  <text x="650" y="123" class="small">consome: produtos, lojas (somente leitura)</text>

  <rect x="640" y="230" width="280" height="70" class="box"/>
  <text x="650" y="255" class="label">Serviço de Pedidos</text>
  <text x="650" y="275" class="small">consome: vendas</text>

  <rect x="640" y="310" width="280" height="70" class="box"/>
  <text x="650" y="335" class="label">Serviço de Análise</text>
  <text x="650" y="355" class="small">consome: vendas</text>

  <!-- Databases (separação de ownership) -->
  <ellipse cx="780" cy="420" rx="125" ry="35" fill="#fff" stroke="#1f2937" stroke-width="2"/>
  <text x="690" y="420" class="label">DB de Inventário (estoque, ajustes)</text>

  <ellipse cx="780" cy="475" rx="125" ry="30" fill="#fff" stroke="#1f2937" stroke-width="2"/>
  <text x="690" y="478" class="small">DB de Cadastro (produtos, lojas)</text>

  <!-- Query Service -->
  <rect x="640" y="520" width="280" height="60" class="box"/>
  <text x="650" y="555" class="label">Serviço de Consulta de Estoque</text>

  <!-- Frontend -->
  <rect x="900" y="520" width="60" height="60" class="box"/>
  <text x="910" y="555" class="small">Web</text>

  <!-- Flows POS/Admin/Cadastro para Kafka -->
  <line x1="190" y1="95" x2="415" y2="125" stroke="#374151" stroke-width="2" class="arrow"/>
  <text x="235" y="115" class="small">produz (vendas)</text>

  <line x1="370" y1="95" x2="415" y2="190" stroke="#374151" stroke-width="2" class="arrow"/>
  <text x="330" y="160" class="small">produz (ajustes)</text>

  <line x1="370" y1="190" x2="415" y2="255" stroke="#374151" stroke-width="2" class="arrow"/>
  <text x="300" y="225" class="small">produz (produtos/lojas)</text>

  <!-- Consumos a partir do Kafka -->
  <line x1="595" y1="125" x2="640" y2="100" stroke="#374151" stroke-width="2" class="arrow"/>
  <text x="610" y="90" class="small">consome</text>

  <line x1="595" y1="190" x2="640" y2="100" stroke="#374151" stroke-width="2" class="arrow"/>

  <line x1="595" y1="255" x2="640" y2="120" stroke="#374151" stroke-width="2" class="arrow"/>
  <text x="610" y="140" class="small">consome</text>

  <line x1="595" y1="125" x2="640" y2="255" stroke="#374151" stroke-width="2" class="arrow"/>
  <text x="610" y="240" class="small">consome</text>

  <line x1="595" y1="125" x2="640" y2="335" stroke="#374151" stroke-width="2" class="arrow"/>
  <text x="610" y="320" class="small">consome</text>

  <!-- Atualização de DB Inventário pelo Serviço de Inventário -->
  <line x1="780" y1="220" x2="780" y2="385" stroke="#374151" stroke-width="2" class="arrow"/>
  <text x="785" y="300" class="small">atualiza</text>

  <!-- Serviço de Inventário leitura de DB Cadastro (somente leitura, conceitual) -->
  <line x1="780" y1="385" x2="780" y2="445" stroke="#94a3b8" stroke-dasharray="4,4" stroke-width="2" class="arrow"/>
  <text x="785" y="438" class="small">lê (R-only)</text>

  <!-- Consulta lê DB e Frontend consulta a API -->
  <line x1="780" y1="510" x2="780" y2="520" stroke="#374151" stroke-width="2" class="arrow"/>
  <text x="785" y="515" class="small">lê</text>

  <line x1="930" y1="555" x2="900" y2="555" stroke="#374151" stroke-width="2" class="arrow"/>
  <text x="905" y="545" class="small">consulta</text>
</svg>
